<?xml version="1.0"?>
<prefab>
  <eElement alignx="MinMax" aligny="MinMax" layout_type="Vertical" >
    <cScript>
      ui = entity
    </cScript>
    <eMenuBar>
      <eMenu text="file" >
        <eMenuItem text="open" >
          <cScript>
            entity.find_component("cReceiver").add_mouse_left_down_listener(function()
              local d = find_udt("Entity").static_functions.create()
		          d.load("prefabs/input_dialog")
              local l = find_udt("Entity").static_functions.create()
		          l.load("prefabs/layer")
              
              d.find_driver("dWindow").set_title("File Name")
              d.find_driver("dInputDialog").add_callback(function(ok, text)
                if ok then 
                  load_scene(text)
                end
                l.get_parent().remove_child(l)
              end)
              l.add_child(d)
              ui.add_child(l)
            end)
          </cScript>
        </eMenuItem>
        <eMenuItem text="save" >
          <cScript>

          </cScript>
        </eMenuItem>
      </eMenu>
    </eMenuBar>
    <eSplitter type="Horizontal" alignx="MinMax" aligny="MinMax" >
      <eSplitter type="Horizontal" alignx="MinMax" aligny="MinMax" width_factor="8" >
        <eScroller type="Vertical" padding="4,4,4,4" alignx="MinMax" aligny="MinMax" width_factor="2" border="1" >
        </eScroller>
        <eElement name="scene" alignx="MinMax" aligny="MinMax" width_factor="8" >
          <cScript>
            scene = entity
            
            prefab = {}
            prefab.p = nil
            
            function load_scene(filename)
              if prefab.p then scene.remove_child(prefab) end
              prefab = find_udt("Entity").static_functions.create()
		          prefab.load(filename)
              scene.add_child(prefab)
              
              update_hierachy()
            end
          </cScript>
        </eElement>
      </eSplitter>
      <eSplitter type="Vertical" alignx="MinMax" aligny="MinMax" width_factor="2" >
        <eScroller type="Vertical" padding="4,4,4,4" alignx="MinMax" aligny="MinMax" border="1" >
          <eTree name="hierarchy" padding="4,4,4,4" alignx="MinMax">
            <cScript>
              hierarchy = entity
              function update_hierachy()
                if hierarchy.get_children_count() > 0 then
                  hierarchy.remove_child(hierarchy.get_child(0))
                end
                if prefab.p then
                  function create_nodes(src, dst)
                    local count = src.get_children_count()
                    if count > 0 then
                      local e = find_udt("Entity").static_functions.create()
                      e.load("prefabs/tree_node")
                      e.find_driver("dTreeNode").set_title("["..src.get_name().."]")
                      dst.add_child(e)
                      for i = 0, count-1, 1 do
                        local c = src.get_child(i)
                        create_nodes(c, e)
                      end
                    else
                      local e = find_udt("Entity").static_functions.create()
                      e.load("prefabs/tree_leaf")
                      e.find_driver("dTreeLeaf").set_title("["..src.get_name().."]")
                      dst.add_child(e)
                    end
                  end
                  create_nodes(prefab, hierarchy)
                end
              end
            </cScript>
          </eTree>
        </eScroller>
        <eScroller type="Vertical" padding="4,4,4,4" alignx="MinMax" aligny="MinMax" border="1">
          <eTree name="inspector" padding="4,4,4,4" alignx="MinMax" aligny="MinMax" />
        </eScroller>
      </eSplitter>
    </eSplitter>
  </eElement>
</prefab>
